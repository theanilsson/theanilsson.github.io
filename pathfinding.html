<!DOCTYPE HTML>
<html>
	<head>
		<title>Thea Nilsson - Gameplay & Systems Programmer</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="landing is-preload">
		<div id="page-wrapper">

			<!-- Header -->
				<header id="header" class="alt">
					<h1><a href="index.html">Portfolio by Thea Nilsson</a></h1>
					<nav id="nav">
						<ul>
							<li><a href="index.html">Home</a></li>
							<li>
								<a href="#">Personal Work Highlights<i class="icon solid fab fa-angle-down" style="color: #fff; padding-left: 0.25em;"></i></a>
								<ul>
									<li><a href="specialization.html">Battle Royale Simulation Using Heatmaps</a></li>
									<li><a href="movement.html">Advanced PhysX Based FPS Movement</a></li>
									<li><a href="enemysystem.html">Diablo 3 Inspired Enemy AI System</a></li>
									<li><a href="pathfinding.html">A-Star NavMesh Pathfinding and Funneling</a></li>
									<li><a href="decals.html">Deferred Rendering Decal System</a></li>
								</ul>
							</li>
							<li><a href="groupprojects.html">Group Projects</a></li>
							<li><a href="aboutme.html">About Me</a></li>
							<li>
								<a href="https://github.com/theanilsson" target="_blank" class="fab fa-github" style="font-size: 1.75em; color:#FFF; padding-right: 0.1em;"></a>
							</li>
							<li>
								<a href="https://www.linkedin.com/in/theanilsson/" target="_blank" class="fab fa-linkedin" style="font-size: 1.75em; color:#FFF; padding-left: 0.1em; padding-right: 0.1em;"></a>
							</li>
							<li>
								<a href="mailto:thea.nom.vy@gmail.com" target="_blank" style="padding-left: 0.1em; padding-right: 0.1em; vertical-align: middle;"><img src="images/Email Icon White.png" alt="" style="width: 2em; height: 1.9em;"/></a>
							</li>
							<li>
								<a href="files/Thea Nilsson CV.pdf" target="_blank" style="padding-left: 0.1em; padding-right: 0.1em; vertical-align: middle;"><img src="images/CV Icon White.png" alt="" style="width: 1.35em; height: 1.9em;"/></a>
							</li>
						</ul>						
					</nav>
				</header>

			<!-- Banner -->
				<section id="banner">
					<h2>Thea Nilsson</h2>
					<p>Gameplay & Systems Programmer</p>
				</section>

				<!-- Scrollmenu -->
					<section id="scrollmenu">
						<p>Content:</p>
						<ul>
							<li><a href="#summary">Summary</a></li>
							<li><a href="#background">Background</a></li>
							<li><a href="#astar">A-Star</a></li>
							<li><a href="#funneling">Funneling</a></li>
							<li><a href="#showcase">Showcase</a></li>
						</ul>	
						<a id="backtotop" href="#banner">â†‘ Back to top</a>
					</section>

			<!-- Main -->
			<section id="main" class="container" style="padding-top: 1em; padding-bottom: 0em;">
				<section class="box special" style="padding: 2em 0 2em 0;">
					<header class="major" style="padding: 0;">
						<h2 style="color: #FFC500;">A-Star NavMesh Pathfinding and Funneling</h2>
					</header>
					<span class="image featured" style="width: auto; display: contents;"><img src="images/PathfindingShowcase.gif" alt="" style="width: -webkit-fill-available; justify-self: center; margin: 1.5em 0 2em 0; border-top: #ffffff50 1px solid; border-bottom: #ffffff50 1px solid;"/></span>

					<div class="scrollnavitem" id="summary"></div>
					<ul class="actions special" style="margin-bottom: 0;">
						<li><a href="https://github.com/theanilsson/Astar-Navmesh-Pathfinding-and-Funneling" target="_blank" class="button alt" style="display: flex;">View the implementation on GitHub<p class="fab fa-github" style="margin: 0 0 0 0.5em; font-size: xx-large; display: flex; align-self: anchor-center;"></p></a></li>
					</ul>
				</section>

				<section class="box special">
					<h4 style="text-align: left; color: #FFC500;">Summary</h4>
					<div class="scrollnavitem" id="background"></div>
					<p style="text-align: left; margin-bottom: 0;">NavMesh, short for navigation mesh, is a non-rendered object in a game world composed entirely of convex polygons (closed 2D shapes with three or more outward-pointing sides). These polygons are connected by shared edges, forming a mesh that enables the calculation of viable paths between two points. This system is primarily used to help AI-controlled (or indirectly player-controlled) characters navigate the environment. NavMesh pathfinding is a core component in many modern games, with the A-Star algorithm being one of the most popular and efficient methods for determining these paths. Once a viable path has been found, regardless which algorithm was used to find it, a smoothing algorithm (in this case funneling) is needed to make the path both more efficient and better looking. This is because pathfinding algorithms usually only find the shortest path via centerpoints of polygons, not the actual shortest path between the start and end points. An actor wandering centerpoint to centerpoint would not only look strange doing so, but also take far longer to get to its goal than it needed to.</p>
				</section>

				<section class="box special">
					<h4 style="text-align: left; color: #FFC500;">From Curiosity to Requirement</h4>
					<p style="text-align: left; margin-bottom: 1em;">During the spring of my first year at TGA we had a course called "Datastructures and Algorithms", where one of the assignments was to implement a pathfinding algorithm usable on both NavMeshes and 2D grids. Even though the initial version I made as part of that assignment was very unoptimized and had no smoothing algorithm to speak of, the assignment sparked a curiosity in me regarding game AI as a broader field and especially the algorithms that drive intelligent behavior. That curiosity stayed with me, pushing me to explore pathfinding more deeply and refine my skills outside the classroom.</p>
					<p style="text-align: left; margin-bottom: 1em;">During the summer, with some extra free time on my hands, I revisited the project and challenged myself to implement a basic smoothing algorithm. My first attempt was rudimentary, relying on midpoints between triangle centerpoints to create smoother paths, but it served its purpose as a proof of concept. However, once I started using that version in a larger project, I quickly realized it couldn't be used for more than a few actors at a time without bogging down performance. It was full of inefficient memory allocations and unnecessary loops over large collections. Around the same time, I also found out that an efficient smoothing algorithm would be a requirement in a later group project. With a new sense of urgency, I committed myself to reworking the entire system. Over the course of a week, I iterated repeatedly on the pathfinding logic and rewrote the smoothing algorithm from the ground up. The result, as seen on this page, was a far more efficient and scalable solution, one that could meet the performance needs of more demanding projects.</p>
					<div class="scrollnavitem" id="astar"></div>
					<p style="text-align: left; margin-bottom: 0;">In my opinion, the biggest flaw of my implementation is that it isn't <b class="highlightedtext">thread safe</b>, but I know exactly which modifications I would need to make for it to be thread safe if I were to encounter a situation where I need it to be. My focus when optimizing my implementation has instead been to <b class="highlightedtext">make better use of the cache</b>, <b class="highlightedtext">reduce memory overhead</b> and <b class="highlightedtext">eliminate redundant iterations</b>.</p>
				</section>

				<section class="box special">
					<div class="row">
						<div class="col-12">
							<h4 style="text-align: left; color: #FFC500;">A-Star pathfinding</h4>
						</div>
					</div>
					<div class="row">
						<div class="col-12">
							<p style="text-align: left; margin-bottom: 1em;">My implementation defines polygons as "nodes" and currently only works on NavMeshes made up entirely of triangles. <b class="highlightedtext">I could adapt it to handle polygons with more sides without too much effort</b>, but using triangle meshes was enough to satisfy my own curiosity and to fulfill the requirements of the projects I needed to use the algorithms in, so I settled for that.</p>
							<p style="text-align: left; margin-bottom: 1em;">The pathfinding algorithm works by traversing a priority queue, sorted by the cost of reaching each node from the starting node, and marking visited nodes along with updating their cost as the algorithm goes along. As the algorithm progresses it tracks which nodes it had to walk through to get to each other node by the shortest path there.</p>
							<span class="image featured" style="width: auto; display: contents;"><img src="images/Astar frontier setup.png" alt="" style="width: -webkit-fill-available; max-width: 716px; justify-self: center; padding: 0 0 0 0; border: 1px solid #fcfcfc50; border-radius: 2px;"/></span>
							<a class="highlightpageanchor2" href="https://github.com/theanilsson/Astar-Navmesh-Pathfinding-and-Funneling/blob/main/code/NavMesh.cpp#L143" target="_blank">Go to the snippet on GitHub</a>

							<p style="text-align: left; margin: 2em 0 1em 0;">If the algorithm traverses all nodes by shared edges originating from the start node without reaching its goal, the algorithm fails. This can only happen if a NavMesh was fed to the algorithm where not all triangles share an edge. It could also happen if I were to implement <b class="highlightedtext">a way to make nodes untraversable (driven by gameplay), signifying a blocked or otherwise obstructed path.</b></p>
							<p style="text-align: left; margin-bottom: 1em;">If the algorithm succeeds in traversing its way to the end node however, it constructs a collection consisting of the shortest path of nodes used to reach the end node from the start node. Using this collection it then constructs a collection of "portals". Portals are synonymous with edges, consisting of two of the triangle's three vertices. The only difference is that a portal has to be an edge the actor would need to walk through to traverse along the path to reach the end. These portals are then fed to the funneling algorithm to produce the final smooth path. <b class="hover_img"><a>The resulting path before any funneling is applied is displayed as the pink line in the visualization shown when hovering over this sentence.<span><img src="images/Astar without funneling.png" alt="image" style="width: auto; max-width: 40em;"/></span></a></b></p>

							<span class="image featured" style="width: auto; display: contents;"><img src="images/Astar found path.png" alt="" style="width: -webkit-fill-available; max-width: 1007px; justify-self: center; padding: 0 0 0 0; border: 1px solid #fcfcfc50; border-radius: 2px;"/></span>
							<div class="scrollnavitem" id="funneling"></div>
							<a class="highlightpageanchor2" href="https://github.com/theanilsson/Astar-Navmesh-Pathfinding-and-Funneling/blob/main/code/NavMesh.cpp#L174" target="_blank">Go to the snippet on GitHub</a>
							<!-- <span class="image featured" style="width: auto; display: contents;"><img src="images/Astar without funneling.png" alt="" style="width: -webkit-fill-available; max-width: 700px; justify-self: center; padding: 0 0 0 0; margin-top: 2em; border: 1px solid #fcfcfc50; border-radius: 2px;"/></span> -->
						</div>
					</div>
				</section>

				<section class="box special">
					<div class="row">
						<div class="col-12">
							<h4 style="text-align: left; color: #FFC500;">Funneling the Found Path</h4>
						</div>
					</div>
					<div class="row">
						<div class="col-12">
							<p style="text-align: left; margin-bottom: 1em;">The funneling algorithm essentially functions like plastic cling wrap visually. It tries to wrap the path along corners on the way to the goal without overshooting the corner and "ripping" the cling wrap. Though funneling is a more apt name for the algorithm, since it essentially works by defining cones that it keeps narrowing more and more, which end up looking like funnels.</p>
							<p style="text-align: left; margin-bottom: 1em;">The start of the algorithm works by defining either vertex from the first portal as the apex of the funnel (they are assumed to be the same and that is always the case in my implementation) and the left and right points of the second portal as the left and right points of the funnel, essentially defining two edges, one spanning from the left to the apex and one spanning from the right to the apex, forming a cone.</p>
							<span class="image featured" style="width: auto; display: contents;"><img src="images/Astar apex.png" alt="" style="width: -webkit-fill-available; max-width: 810px; justify-self: center; padding: 0 0 0 0; border: 1px solid #fcfcfc50; border-radius: 2px;"/></span>
							<a class="highlightpageanchor2" href="https://github.com/theanilsson/Astar-Navmesh-Pathfinding-and-Funneling/blob/main/code/NavMesh.cpp#L287" target="_blank">Go to the snippet on GitHub</a>
							<p style="text-align: left; margin: 1em 0 1em 0;">Then the traversing of the path of portals begins. Stepping along the sorted path of portals, the algorithm checks if the portal's left point is a better left point for the funnel to use without overshooting the right point, and vice versa for the right portal point to the right funnel point. If the left or right points of the portal were to make the funnel overshoot (meaning the right point of the funnel would be to the left of the left point or vice versa), that means a corner for the final smooth path has been found and the algorithm should define a new funnel apex and new left and right points using the next portal following the one where the corner point was found on. Once the iteration reaches the final portal, the best smooth path has always been found and we can allow the actor to traverse along it. <b class="hover_img"><a>The resulting smoothed path is displayed as the pink line in the visualization shown when hovering over this sentence.<span><img src="images/Astar funneled.png" alt="image" style="width: auto; max-width: 40em;"/></span></a></b></p>
							<span class="image featured" style="width: auto; display: contents;"><img src="images/Astar funneling iterations.png" alt="" style="width: -webkit-fill-available; max-width: 636px; justify-self: center; padding: 0 0 0 0; border: 1px solid #fcfcfc50; border-radius: 2px;"/></span>
							<div class="scrollnavitem" id="showcase"></div>
							<a class="highlightpageanchor2" href="https://github.com/theanilsson/Astar-Navmesh-Pathfinding-and-Funneling/blob/main/code/NavMesh.cpp#L336" target="_blank">Go to the snippet on GitHub</a>
						</div>
					</div>
				</section>

				<section class="box special">
					<div class="row">
						<div class="col-12">
							<h4 style="text-align: left; color: #FFC500;">Used in Projects</h4>
						</div>
					</div>
					<div class="row">
						<div class="col-12">
							<h5 style="text-align: left; color: #FF7FE8; padding: 0 0 0.5em 0; margin-bottom: 0;">The initial unoptimized version used on a 2D grid in our 4th group project</h5>
							<span class="image featured" style="width: auto; display: contents;"><img src="images/Grid pathfinding.gif" alt="" style="width: -webkit-fill-available; justify-self: center; padding: 0 0 2em 0;"/></span>
						</div>
					</div>
					<div class="row">
						<div class="col-12">
							<h5 style="text-align: left; color: #FF7FE8; padding: 0 0 0.5em 0; margin-bottom: 0;">The optimized and funneled version converted to work in 3D and used on a NavMesh in our 6th group project</h5>
							<span class="image featured" style="width: auto; display: contents;"><img src="images/EnemySystemShowcase.gif" alt="" style="width: -webkit-fill-available; justify-self: center; padding: 0 0 0 0;"/></span>
						</div>
					</div>
					<!-- <div class="row">
						<div class="col-12">
							<h5 style="text-align: left; color: #FF7FE8; padding: 0 0 0.5em 0; margin-bottom: 0;">The optimized and funneled version converted to 3D and used on a NavMesh in our 7th group project</h5>
							<span class="image featured" style="width: auto; display: contents;"><img src="images/EnemySystemShowcase.gif" alt="" style="width: -webkit-fill-available; justify-self: center; padding: 0 0 0 0;"/></span>
						</div>
					</div> -->
				</section>

				<section class="box special">
					<ul class="actions special" style="margin-bottom: 0;">
						<li><a href="https://github.com/theanilsson/Astar-Navmesh-Pathfinding-and-Funneling" target="_blank" class="button alt" style="display: flex;">View the implementation on GitHub<p class="fab fa-github" style="margin: 0 0 0 0.5em; font-size: xx-large; display: flex; align-self: anchor-center;"></p></a></li>
					</ul>
				</section>
			</section>

			<!-- Footer -->
				<footer id="footer">
					<ul style="list-style-type: none;">
						<li>
							<a href="https://github.com/theanilsson" target="_blank" class="fab fa-github" style="font-size: 1.75em; color:#FFF; padding-right: 0.1em; border-bottom: none; vertical-align: middle;"></a>
							<a href="https://www.linkedin.com/in/theanilsson/" target="_blank" class="fab fa-linkedin" style="font-size: 1.75em; color:#FFF; padding-left: 0.1em; padding-right: 0.1em; border-bottom: none; vertical-align: middle;"></a>
							<a href="mailto:thea.nom.vy@gmail.com" target="_blank" style="padding-left: 0.1em; padding-right: 0.1em; vertical-align: middle; border-bottom: none; vertical-align: middle;"><img src="images/Email Icon White.png" alt="" style="width: 2em; height: 1.9em; vertical-align: middle;"/></a>
							<a href="files/Thea Nilsson CV.pdf" target="_blank" style="padding-left: 0.1em; padding-right: 0.1em; vertical-align: middle; border-bottom: none; vertical-align: middle;"><img src="images/CV Icon White.png" alt="" style="width: 1.35em; height: 1.9em; vertical-align: middle;"/></a>
						</li>
					</ul>
					<ul style="list-style-type: none;">
						<li style="margin-bottom: 1em; color: #FF7FE8; font-size: 0.8em;">This website was designed & developed by Thea Nilsson using only HTML & CSS</li>
						<li style="color: #FF7FE8; font-size: 0.8em;">The initial website framework was based on a template by <a style="border-bottom: none; font-size: inherit;" class="highlightpageanchor2" href="http://html5up.net" target="_blank">HTML5 UP</a></li>
					</ul>
				</footer>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>