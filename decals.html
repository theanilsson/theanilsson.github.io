<!DOCTYPE HTML>
<html>
	<head>
		<title>Thea Nilsson - Gameplay & Systems Programmer</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="landing is-preload">
		<div id="page-wrapper">

			<!-- Header -->
				<header id="header" class="alt">
					<h1><a href="index.html">Portfolio by Thea Nilsson</a></h1>
					<nav id="nav">
						<ul>
							<li><a href="index.html">Home</a></li>
							<li>
								<a href="#">Personal Work Highlights<i class="icon solid fab fa-angle-down" style="color: #fff; padding-left: 0.25em;"></i></a>
								<ul>
									<li><a href="specialization.html">Battle Royale Simulation Using Heatmaps</a></li>
									<li><a href="movement.html">Advanced PhysX Based FPS Movement</a></li>
									<li><a href="enemysystem.html">Diablo 3 Inspired Enemy AI System</a></li>
									<li><a href="pathfinding.html">A-Star NavMesh Pathfinding and Funneling</a></li>
									<li><a href="decals.html">Deferred Rendering Decal System</a></li>
								</ul>
							</li>
							<li><a href="groupprojects.html">Group Projects</a></li>
							<li><a href="aboutme.html">About Me</a></li>
							<li>
								<a href="https://github.com/theanilsson" target="_blank" class="fab fa-github" style="font-size: 1.75em; color:#FFF; padding-right: 0.1em;"></a>
							</li>
							<li>
								<a href="https://www.linkedin.com/in/theanilsson/" target="_blank" class="fab fa-linkedin" style="font-size: 1.75em; color:#FFF; padding-left: 0.1em; padding-right: 0.1em;"></a>
							</li>
							<li>
								<a href="mailto:thea.nom.vy@gmail.com" target="_blank" style="padding-left: 0.1em; padding-right: 0.1em; vertical-align: middle;"><img src="images/Email Icon White.png" alt="" style="width: 2em; height: 1.9em;"/></a>
							</li>
							<li>
								<a href="files/Thea Nilsson CV.pdf" target="_blank" style="padding-left: 0.1em; padding-right: 0.1em; vertical-align: middle;"><img src="images/CV Icon White.png" alt="" style="width: 1.35em; height: 1.9em;"/></a>
							</li>
						</ul>						
					</nav>
				</header>

			<!-- Banner -->
				<section id="banner">
					<h2>Thea Nilsson</h2>
					<p>Gameplay & Systems Programmer</p>
				</section>

				<!-- Scrollmenu -->
					<section id="scrollmenu">
						<p>Content:</p>
						<ul>
							<li><a href="#summary">Summary</a></li>
							<li><a href="#motivations">Motivations</a></li>
							<li><a href="#render">Render Setup</a></li>
							<li><a href="#editor">Editor Workflow</a></li>
						</ul>	
						<a id="backtotop" href="#banner">â†‘ Back to top</a>
					</section>

			<!-- Main -->
				<section id="main" class="container" style="padding-top: 1em; padding-bottom: 0em;">
					<section class="box special" style="padding: 2em 0 2em 0;">
						<header class="major" style="padding: 0;">
							<h2 style="color: #FFC500;">Deferred Rendering Decal System</h2>
						</header>
						<span class="image featured" style="width: auto; display: contents;"><img src="images/DecalsShowcase.gif" alt="" style="width: -webkit-fill-available; justify-self: center; margin: 1.5em 0 2em 0; border-top: #ffffff50 1px solid; border-bottom: #ffffff50 1px solid;"/></span>

						<div class="scrollnavitem" id="summary"></div>
						<ul class="actions special" style="margin-bottom: 0;">
							<li><a href="https://github.com/theanilsson/Deferred-Rendering-Decal-System" target="_blank" class="button alt" style="display: flex;">View the implementation on GitHub<p class="fab fa-github" style="margin: 0 0 0 0.5em; font-size: xx-large; display: flex; align-self: anchor-center;"></p></a></li>
						</ul>
					</section>

					<section class="box special">
						<h4 style="text-align: left; color: #FFC500;">Summary</h4>
						<div class="scrollnavitem" id="motivations"></div>
						<p style="text-align: left; margin-bottom: 0px;">Decal rendering is a method of projecting textures onto meshes in the game world. The first choice to make when developing Decals is what rendering technique to use, <b class="highlightedtext">Forward or Deferred Rendering</b>. I chose to make my implementation using Deferred Rendering. It works by referencing the <b class="highlightedtext">Geometry Buffer</b>, which is a set of textures containing the positions, colors, normals, materials (etc.) of objects in the game world at their closest point to the camera/viewport at each pixel on the screen. Using these Geometry Buffer textures, Decals use <b class="highlightedtext">Planar Projection</b> (linearly mapping 3D points onto a 2D plane) to essentially slap a texture of their own onto the meshes of the rendered game world, regardless of what textures were originally rendered there. That is not to say that it changes the textures of objects its Planar Projection "collides" with, but rather that it temporarily changes what color (and sometimes more) is shown to the viewer at that pixel.</p>
					</section>

					<section class="box special">
						<h4 style="text-align: left; color: #FFC500;">My Motivations and Empowering the Artists</h4>
						<p style="text-align: left; margin-bottom: 1em ;">Late in fall 2024, I decided to take on the project of implementing Decals for my own personal enjoyment in my free time and because I wanted to take a small but significant step up from the graphics programming basics we had been taught a few months earlier at TGA. Another reason was that even though graphics programming isn't my main focus, I still enjoy it quite a bit and I wanted something slightly out of the ordinary relating to graphics programming to showcase in my portfolio to show my range.</p>
						<div class="scrollnavitem" id="render"></div>
						<p style="text-align: left; margin-bottom: 0px;">An added benefit of my success with implementing Decals was that <b class="highlightedtext">I was easily able to bring my implementation into our group project</b> team's custom engine, Dream Engine. This <b class="highlightedtext">empowered our artists</b> to add even more depth, interest and immersion to our environments. They added textures of posters, dirt, stickers and so much more onto generic floors and walls. They added arrows and signage guiding the player to key points in our level. They added textures of green goo for us programmers to dynamically place wherever our player's goo projectiles collide with the game world, defining an area that slows enemies and using Decals to visually convey that information to the player.</p>
					</section>

					<section class="box special">
						<div class="row">
							<div class="col-12">
								<h4 style="text-align: left; color: #FFC500;">The Render Setup</h4>
							</div>
						</div>
						<div class="row">
							<div class="col-12">
								<h5 style="text-align: left; color: #FF7FE8; padding: 0 0 0.5em 0; margin-bottom: 0;">Decal Initialization</h5>
								<p style="text-align: left; margin-bottom: 1em;">Each Decal is given a transform (containing position, rotation, and scale) upon creation. When the Decal is then initialized it's assigned a unit cube mesh (a cube with scale 1 along all axes before transforms are applied) matching the width and height of the Decal's texture in x and y scale respectively, and using z scale to determine how far (in both directions) along the forward axis the Planar Projection should project from the origin position of the decal. Position and rotation determine the location in the game world and the facing of the forward axis to be used for the Planar Projection. Essentially the transform is the Decal's ObjectToWorld matrix.</p>
								<span class="image featured" style="width: auto; display: contents;"><img src="images/Decal Initialization.png" alt="" style="width: -webkit-fill-available; max-width: 559px; justify-self: center; padding: 0; border: 1px solid #fcfcfc50; border-radius: 2px;"/></span>
							</div>
						</div>
						<div class="row">
							<div class="col-12">
								<h5 style="text-align: left; color: #FF7FE8; padding: 2em 0 0.5em 0; margin-bottom: 0;">Decal Draw Calls</h5>
								<p style="text-align: left; margin-bottom: 1em;">In the setup I created for our engine, the level makes the draw calls for all Decals in succession. This is done right after rendering the level geometry onto the Geometry Buffer but before rendering any enemies, the player and any other objects we don't want the Decals to be projected onto, since Decals will only project onto what is currently on the Geometry Buffer textures before the Decals are rendered. Another way to control what they project onto would be to use <b class="highlightedtext">Layer Masks stored on the Geometry Buffer</b> to filter out what can't be projected onto. With further development, the ordering (or Layer Masking) could easily be exposed to be <b class="highlightedtext">data driven from another interface, allowing artists and designers</b> to assign in the level editor (or another tool) which objects Decals should project onto, and which to not project onto, and to have such settings be different for different Decals.</p>
								<p style="text-align: left; margin-bottom: 1em;">The "myDeferredDecals" vector contains the Decals placed in our level editor (mainly by Artists, using documentation provided by me). The "myGooPuddleDecals" vector contains the Decals created by the player's goo gun during regular gameplay. They all render using a new function I created for our engine's model drawer that expands the object buffer to include both the untouched and inverse versions of the ObjectToWorld matrix. This was done since it was the first instance of us needing the inverse of an object's ObjectToWorld matrix in our shaders. <b class="highlightedtext">I could have just inverted the matrix in the shader using the GPU, but I decided against that because, as of the making of my Decals (and still true as of writing this text), our engine's main performance issues were on the GPU, not the CPU</b>.</p>
								<span class="image featured" style="width: auto; display: contents;"><img src="images/Decal Drawcalls.png" alt="" style="width: -webkit-fill-available; max-width: 740px; justify-self: center; padding: 0; border: 1px solid #fcfcfc50; border-radius: 2px;"/></span>
							</div>
						</div>
						<div class="row">
							<div class="col-12">
								<h5 style="text-align: left; color: #FF7FE8; padding: 2em 0 0.5em 0; margin-bottom: 0;">The Vertex Shader</h5>
								<p style="text-align: left; margin-bottom: 1em;">A barebones version of the vertex shader used for regular mesh renderings in our engine, converting the position of the cube mesh to be used for the Planar Projection from local space all the way to projection space.</p>
								<span class="image featured" style="width: auto; display: contents;"><img src="images/GBufferDecalVS.png" alt="" style="width: -webkit-fill-available; max-width: 559px; justify-self: center; padding: 0; border: 1px solid #fcfcfc50; border-radius: 2px;"/></span>
							</div>
						</div>
						<div class="row">
							<div class="col-12">
								<h5 style="text-align: left; color: #FF7FE8; padding: 2em 0 0.5em 0; margin-bottom: 0;">The Pixel Shader</h5>
								<p style="text-align: left; margin-bottom: 1em;">The calculations in the pixel shader are the core of a Decal implementation. Mine starts by dividing the projection space position of the cube mesh by the current resolution of the game (stored in a separate constant buffer which is updated less frequently to save on performance) to calculate the UV coordinates to sample from the Geometry Buffer world space position texture. Then the world space position from the Geometry Buffer is multiplied with the inverse of the cube mesh's ObjectToWorld matrix, so that we can know where that point on the screen is relative to the local space of the cube mesh. We take 0.5 minus the absolute value of the sampled Geometry Buffer local space position and then call the HLSL intrinsic function "clip" to discard any resulting position that would lie outside the bounding volume of the cube mesh. If the pixel was not discarded in the clip step, we know that the sample is a valid position within the Decal's cube mesh and we can simply use it to calculate the UV coordinate on the Decal texture and draw that sampled color onto the albedo (rgba color) texture of the Geometry Buffer, using a 0.5 positive offset to move the local space position from the range of -0.5 to 0.5 into the range of 0 to 1.</p>
								<p style="text-align: left; margin-bottom: 1em;">This is the most basic form of a Decal rendering. Beyond the data driven possibilities I explained above there are also more elaborate things that can be done when rendering a Decal. <b class="highlightedtext">You can add three dimensionality using Directed Projections</b>. Or you can draw onto any of the textures of the Geometry Buffer besides world position in any combination you wish when rendering a Decal. <b class="highlightedtext">With only slight modifications, alternate versions of this pixel shader could easily be developed to affect not only color but also lighting and shadow calculations (via the normal map and material textures for example), adding exponentially onto the possibilities that Decals provide for the entire development team</b>.</p>
								<div class="scrollnavitem" id="editor"></div>
								<span class="image featured" style="width: auto; display: contents;"><img src="images/GBufferDecalPS.png" alt="" style="width: -webkit-fill-available; max-width: 559px; justify-self: center; padding: 0; border: 1px solid #fcfcfc50; border-radius: 2px;"/></span>
							</div>
						</div>
					</section>

					<section class="box special">
						<div class="row">
							<div class="col-12">
								<h4 style="text-align: left; color: #FFC500;">The Level Editor Workflow</h4>
							</div>
						</div>
						<div class="row">
							<div class="col-12">
								<h5 style="text-align: left; color: #FF7FE8; padding: 0 0 0 0; margin-bottom: 0;">Setup in Unity</h5>
								<p style="text-align: left; margin-bottom: 0.5em;">We use Unity as an external level editor for our engine, exporting the object data to json and binary files to parse in our own engine. The setup for my Decals in Unity is quite simple. It takes the transform as is from any object marked with the tag "DecalBox" and uses the sprite renderer component to find the path of the decal to render and to multiply the x and y values of the transform's scale by the width and height respectively.</p>
								<span class="image featured" style="width: auto; display: contents;"><img src="images/unity scene.png" alt="" style="width: -webkit-fill-available; justify-self: center; padding: 0 0 2em 0;"/></span>
							</div>
						</div>
						<div class="row">
							<div class="col-12">
								<h5 style="text-align: left; color: #FF7FE8; padding: 0 0 0 0; margin-bottom: 0;">Rendered in Our Engine</h5>
								<p style="text-align: left; margin-bottom: 0.5em;">The end result in our engine is a 1:1 replication of the setup displayed in Unity.</p>
								<span class="image featured" style="width: auto; display: contents;"><img src="images/rendered in custom engine.png" alt="" style="width: -webkit-fill-available; justify-self: center; padding: 0 0 0 0;"/></span>
							</div>
						</div>
					</section>

					<section class="box special">
						<ul class="actions special" style="margin-bottom: 0;">
							<li><a href="https://github.com/theanilsson/Deferred-Rendering-Decal-System" target="_blank" class="button alt" style="display: flex;">View the implementation on GitHub<p class="fab fa-github" style="margin: 0 0 0 0.5em; font-size: xx-large; display: flex; align-self: anchor-center;"></p></a></li>
						</ul>
					</section>
				</section>

			<!-- Footer -->
				<footer id="footer">
					<ul style="list-style-type: none;">
						<li>
							<a href="https://github.com/theanilsson" target="_blank" class="fab fa-github" style="font-size: 1.75em; color:#FFF; padding-right: 0.1em; border-bottom: none; vertical-align: middle;"></a>
							<a href="https://www.linkedin.com/in/theanilsson/" target="_blank" class="fab fa-linkedin" style="font-size: 1.75em; color:#FFF; padding-left: 0.1em; padding-right: 0.1em; border-bottom: none; vertical-align: middle;"></a>
							<a href="mailto:thea.nom.vy@gmail.com" target="_blank" style="padding-left: 0.1em; padding-right: 0.1em; vertical-align: middle; border-bottom: none; vertical-align: middle;"><img src="images/Email Icon White.png" alt="" style="width: 2em; height: 1.9em; vertical-align: middle;"/></a>
							<a href="files/Thea Nilsson CV.pdf" target="_blank" style="padding-left: 0.1em; padding-right: 0.1em; vertical-align: middle; border-bottom: none; vertical-align: middle;"><img src="images/CV Icon White.png" alt="" style="width: 1.35em; height: 1.9em; vertical-align: middle;"/></a>
						</li>
					</ul>
					<ul style="list-style-type: none;">
						<li style="margin-bottom: 1em; color: #FF7FE8; font-size: 0.8em;">This website was designed & developed by Thea Nilsson using only HTML & CSS</li>
						<li style="color: #FF7FE8; font-size: 0.8em;">The initial website framework was based on a template by <a style="border-bottom: none; font-size: inherit;" class="highlightpageanchor2" href="http://html5up.net" target="_blank">HTML5 UP</a></li>
					</ul>
				</footer>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>